---
layout: page
title: ê²°ì œí•˜ê¸°
permalink: /pay/
---

<h2>ğŸ’³ í”„ë¦¬ë¯¸ì—„ ì½˜í…ì¸  ê²°ì œ</h2>

<div id="payment-area">
  <p>ğŸ‘‡ ê²°ì œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
  <div id="paypal-button-container"></div>
</div>

<div id="status" style="margin-top: 1rem;"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>

<!-- PayPal SDK (client-idëŠ” sandboxìš©) -->
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDXB4ilHCdpWzc93i_ZuXy28XF0WD5sRmw",
    authDomain: "csi500.firebaseapp.com",
    projectId: "csi500"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;

  function showStatus(msg) {
    document.getElementById("status").innerText = msg;
  }

  window.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem("user");
    if (!saved) {
      showStatus("âŒ ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
      document.getElementById("payment-area").style.display = "none";
      return;
    }

    currentUser = JSON.parse(saved);
    showStatus("âœ… ë¡œê·¸ì¸ í™•ì¸: " + currentUser.email);

    // PayPal ë²„íŠ¼ ê·¸ë¦¬ê¸°
    paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: '5.00'  // ğŸ’¸ ê²°ì œ ê¸ˆì•¡ ì„¤ì •
            }
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          showStatus("ğŸ‰ ê²°ì œ ì™„ë£Œ! Firestoreì— ì €ì¥ ì¤‘...");

          const uid = currentUser.uid;
          db.collection("payments").doc(uid).set({
            paid: true,
            timestamp: new Date()
          }).then(() => {
            showStatus("âœ… ê²°ì œ ìƒíƒœ ì €ì¥ ì™„ë£Œ! /premium/ í˜ì´ì§€ì—ì„œ ì—´ëŒ ê°€ëŠ¥");
          }).catch((err) => {
            console.error("âŒ Firestore ì €ì¥ ì‹¤íŒ¨", err);
            showStatus("âŒ ì €ì¥ ì‹¤íŒ¨: " + err.message);
          });
        });
      }
    }).render('#paypal-button-container');
  });
</script>
